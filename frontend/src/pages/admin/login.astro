---
import Layout from "../../layouts/Layout.astro";
import Logo from "../../icons/Logo.astro";
---

<Layout title="Admin prihlásenie">
    <main
        class="min-h-screen flex flex-col items-center justify-center bg-gradient-to-br from-[#667eea] to-[#764ba2] p-4 relative overflow-hidden"
    >
        <!-- Background animation effect -->
        <div
            class="absolute -top-1/2 -right-1/2 w-full h-full bg-[radial-gradient(circle,rgba(255,255,255,0.1)_0%,transparent_70%)] animate-[float_20s_infinite_ease-in-out]"
        >
        </div>

        <div class="w-full max-w-[480px] relative z-10">
            <div
                class="bg-white rounded-3xl shadow-2xl p-8 sm:p-12 border border-white/20 animate-[slideUp_0.5s_ease-out]"
            >
                <div class="text-center mb-10">
                    <div class="flex justify-center mb-6">
                        <Logo class="h-20 w-auto" />
                    </div>
                    <h1
                        class="text-3xl sm:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-br from-[#667eea] to-[#764ba2] mb-3"
                    >
                        Admin prihlásenie
                    </h1>
                    <p class="text-base text-gray-600 font-medium">
                        Prihláste sa pre prístup k administrátorskému rozhraniu
                    </p>
                </div>

                <div
                    id="error-message"
                    class="hidden bg-gradient-to-br from-red-100 to-red-200 text-red-900 border-2 border-red-500 rounded-xl py-3 px-5 mb-7 text-center text-sm font-semibold shadow-md animate-[shake_0.5s_ease-in-out]"
                >
                </div>

                <form id="login-form" class="mb-6 space-y-6">
                    <div class="space-y-3">
                        <label
                            for="password"
                            class="block font-semibold text-gray-800 text-base"
                            >Heslo</label
                        >
                        <input
                            type="password"
                            id="password"
                            name="password"
                            placeholder="Zadajte admin heslo"
                            required
                            autofocus
                            class="w-full px-5 py-4 border-2 border-gray-200 rounded-xl text-lg transition-all duration-300 bg-gray-50 focus:outline-none focus:border-[#667eea] focus:bg-white focus:ring-4 focus:ring-[#667eea]/15 hover:border-gray-300"
                        />
                    </div>

                    <button
                        type="submit"
                        id="login-btn"
                        class="w-full py-4 bg-gradient-to-br from-[#667eea] to-[#764ba2] text-white rounded-xl text-lg font-bold uppercase tracking-wider shadow-lg transition-all duration-300 relative overflow-hidden group hover:-translate-y-1 hover:shadow-xl hover:shadow-[#667eea]/50 active:translate-y-0 disabled:opacity-70 disabled:cursor-not-allowed disabled:transform-none"
                    >
                        <span class="relative z-10">Prihlásiť sa</span>
                        <div
                            class="absolute top-0 -left-full w-full h-full bg-gradient-to-r from-transparent via-white/20 to-transparent transition-[left] duration-500 group-hover:left-full"
                        >
                        </div>
                    </button>
                </form>

                <div class="text-center mt-8">
                    <a
                        href="/"
                        class="inline-block text-[#667eea] font-semibold text-sm hover:text-[#764ba2] hover:-translate-x-1 transition-all duration-300"
                    >
                        ← Späť na hlavnú stránku
                    </a>
                </div>
            </div>
        </div>

        <div
            class="mt-10 text-center text-white/95 text-sm font-medium drop-shadow-md"
        >
            <span>Kristián Kekeš & SOŠ Elektrotechnická</span>
        </div>
    </main>

    <script>
        import { api } from "../../lib/api";

        const form = document.getElementById("login-form") as HTMLFormElement;
        const passwordInput = document.getElementById(
            "password",
        ) as HTMLInputElement;
        const loginBtn = document.getElementById(
            "login-btn",
        ) as HTMLButtonElement;
        const errorMessage = document.getElementById(
            "error-message",
        ) as HTMLDivElement;

        form.addEventListener("submit", async (e) => {
            e.preventDefault();

            const password = passwordInput.value;

            if (!password) {
                showError("Prosím zadajte heslo");
                return;
            }

            loginBtn.disabled = true;
            const btnText = loginBtn.querySelector("span");
            if (btnText) btnText.textContent = "Prihlasovanie...";
            hideError();

            try {
                await api.admin.login(password);
                // Redirect to admin page on success
                window.location.href = "/admin/manage";
            } catch (error: any) {
                showError(error.message || "Nesprávne heslo");
                loginBtn.disabled = false;
                if (btnText) btnText.textContent = "Prihlásiť sa";
                passwordInput.value = "";
                passwordInput.focus();
            }
        });

        function showError(message: string) {
            errorMessage.textContent = message;
            errorMessage.classList.remove("hidden");
        }

        function hideError() {
            errorMessage.classList.add("hidden");
        }

        // Check if already authenticated
        document.addEventListener("DOMContentLoaded", async () => {
            try {
                const isAuth = await api.admin.checkAuth();
                if (isAuth) {
                    window.location.href = "/admin/manage";
                }
            } catch (error) {
                // Not authenticated, stay on login page
            }
        });
    </script>
</Layout>

<style>
    /* Custom keyframes that Tailwind doesn't support directly without config */
    @keyframes float {
        0%,
        100% {
            transform: translate(0, 0);
        }
        50% {
            transform: translate(-20%, -20%);
        }
    }

    @keyframes slideUp {
        from {
            opacity: 0;
            transform: translateY(30px) scale(0.95);
        }
        to {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
    }

    @keyframes shake {
        0%,
        100% {
            transform: translateX(0);
        }
        25% {
            transform: translateX(-5px);
        }
        75% {
            transform: translateX(5px);
        }
    }
</style>
